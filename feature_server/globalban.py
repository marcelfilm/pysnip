import jsonfrom twisted.web.client import getPagefrom twisted.internet.task import LoopingCall"""Global ban list. Provided by StackOverflow and friends."""SITE = 'http://aos.nateshoffner.com/blacklist.json'UPDATE_INTERVAL = 5 * 60 # every 5 minute# format is [{"ip" : "1.1.1.1", "reason : "blah"}, ...]class BanManager(object):    bans = None    def __init__(self):        self.loop = LoopingCall(self.update_bans)        self.loop.start(UPDATE_INTERVAL, now = True)            def update_bans(self):        getPage(SITE).addCallback(self.got_bans)        def got_bans(self, data):        bans = json.loads(data)        self.bans = ban_entries = {}        for entry in bans:            ban_entries[entry['ip']] = entry['reason']            def get_ban(self, ip):        if self.bans is None:            return None        try:            return self.bans[ip]        except KeyError:            return None