from twisted.internet.task import LoopingCallimport randomimport commands@commands.name('disco')@commands.admindef toggle_disco(connection):    protocol = connection.protocol    protocol.disco = not protocol.disco    if protocol.disco:        protocol.disco_loop.start(0.3)        protocol.send_chat('DISCO PARTY MODE ENABLED!')    else:        protocol.disco_loop.stop()        protocol.send_chat('The party has been stopped.')commands.add(toggle_disco)DISCO_COLORS = set([    (235, 64, 0),    (128, 232, 121),    (220, 223, 12),    (43, 72, 228),    (216, 94, 231),    (255, 255, 255)])def apply_script(protocol, connection, config):    class DiscoProtocol(protocol):        current_colors = None        disco = False        def __init__(self, *arg, **kw):            protocol.__init__(self, *arg, **kw)            self.disco_loop = LoopingCall(self.update_color)                def update_color(self):            if not self.current_colors:                self.current_colors = DISCO_COLORS.copy()            color = self.current_colors.pop()            self.set_fog_color(color)    return DiscoProtocol, connection